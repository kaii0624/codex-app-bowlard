<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÂãïÁâ©„Çø„ÉØ„Éº„Éê„Éà„É´</title>
  <style>
    :root {
      --bg-top: #12213f;
      --bg-bottom: #071224;
      --panel: rgba(14, 28, 53, 0.85);
      --line: #2f4c77;
      --ink: #f4f8ff;
      --muted: #a7b8d4;
      --accent: #ffd058;
      --accent-strong: #ff9c2a;
      --danger: #ff6f6f;
      --good: #71e39d;
      --radius: 18px;
      --shadow: 0 14px 34px rgba(0, 0, 0, 0.35);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Hiragino Sans", "Yu Gothic", "Noto Sans JP", sans-serif;
      color: var(--ink);
      background:
        radial-gradient(70rem 45rem at 100% -20%, #1f3f6d 0%, transparent 60%),
        radial-gradient(60rem 50rem at -10% 110%, #17345a 0%, transparent 62%),
        linear-gradient(180deg, var(--bg-top), var(--bg-bottom));
      display: flex;
      justify-content: center;
      padding: 12px;
    }

    .app {
      width: min(100%, 430px);
      display: grid;
      gap: 10px;
      align-content: start;
      padding-bottom: 18px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(3px);
    }

    .header {
      padding: 14px;
      display: grid;
      gap: 10px;
    }

    .title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    h1 {
      margin: 0;
      font-size: 1.3rem;
      letter-spacing: 0.02em;
    }

    .timer {
      font-weight: 800;
      color: var(--accent);
      font-size: 1rem;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
    }

    .stat {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 8px;
      text-align: center;
    }

    .label {
      display: block;
      font-size: 0.72rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .value {
      font-size: 1rem;
      font-weight: 700;
    }

    .status {
      min-height: 1.35rem;
      font-size: 0.9rem;
      color: var(--muted);
      font-weight: 700;
    }

    .status.good {
      color: var(--good);
    }

    .status.bad {
      color: var(--danger);
    }

    .battle {
      padding: 12px;
      display: grid;
      gap: 10px;
    }

    .arena {
      height: min(54vh, 420px);
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.13);
      background:
        linear-gradient(180deg, rgba(255, 255, 255, 0.04), transparent 34%),
        repeating-linear-gradient(
          to top,
          rgba(255, 255, 255, 0.03),
          rgba(255, 255, 255, 0.03) 24px,
          transparent 24px,
          transparent 48px
        );
      padding: 10px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: end;
      position: relative;
      overflow: hidden;
    }

    .tower-wrap {
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      gap: 6px;
      position: relative;
    }

    .tower-title {
      position: absolute;
      top: 4px;
      font-size: 0.74rem;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .tower {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column-reverse;
      align-items: center;
      gap: 4px;
      padding: 30px 4px 8px;
    }

    .block {
      width: 86%;
      max-width: 140px;
      min-height: 26px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.24);
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.15rem;
      line-height: 1;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.35), 0 7px 12px rgba(0, 0, 0, 0.25);
      animation: pop 180ms ease-out;
    }

    .block.ai {
      background: linear-gradient(180deg, rgba(255, 177, 118, 0.45), rgba(255, 118, 118, 0.2));
    }

    @keyframes pop {
      from {
        opacity: 0;
        transform: translateY(-8px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .timing {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      gap: 8px;
    }

    .bar {
      height: 20px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.09);
      position: relative;
      overflow: hidden;
    }

    .target {
      position: absolute;
      top: 0;
      height: 100%;
      left: 38%;
      width: 24%;
      border-radius: 999px;
      background: linear-gradient(120deg, rgba(113, 227, 157, 0.7), rgba(255, 208, 88, 0.45));
      border: 1px solid rgba(113, 227, 157, 0.75);
    }

    .needle {
      position: absolute;
      top: -4px;
      width: 10px;
      height: 28px;
      border-radius: 999px;
      background: linear-gradient(180deg, #ffffff, #ffc770);
      left: 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.45);
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    button {
      min-height: 46px;
      border: 0;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 800;
      cursor: pointer;
      color: #1f1f1f;
      background: linear-gradient(120deg, var(--accent), var(--accent-strong));
    }

    button.secondary {
      color: var(--ink);
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
      font-weight: 700;
    }

    .guide {
      margin: 0;
      font-size: 0.82rem;
      color: var(--muted);
      line-height: 1.45;
      text-align: center;
    }
  </style>
</head>
<body>
  <main class="app">
    <section class="panel header">
      <div class="title-row">
        <h1>ÂãïÁâ©„Çø„ÉØ„Éº„Éê„Éà„É´</h1>
        <div class="timer" id="timer">45s</div>
      </div>

      <div class="stats" aria-label="„Ç≤„Éº„É†ÊÉÖÂ†±">
        <div class="stat">
          <span class="label">„Çπ„Ç≥„Ç¢</span>
          <span class="value" id="score">0</span>
        </div>
        <div class="stat">
          <span class="label">YOU</span>
          <span class="value" id="youHeight">0</span>
        </div>
        <div class="stat">
          <span class="label">CPU</span>
          <span class="value" id="cpuHeight">0</span>
        </div>
      </div>

      <div class="status" id="status">START„ÇíÊäº„Åó„Å¶ÂãùË≤†ÈñãÂßã</div>
    </section>

    <section class="panel battle" aria-label="„Éê„Éà„É´„Ç®„É™„Ç¢">
      <div class="arena" id="arena">
        <div class="tower-wrap">
          <div class="tower-title">YOUR TOWER</div>
          <div class="tower" id="youTower" aria-live="polite"></div>
        </div>
        <div class="tower-wrap">
          <div class="tower-title">CPU TOWER</div>
          <div class="tower" id="cpuTower" aria-live="polite"></div>
        </div>
      </div>

      <div class="timing">
        <div class="bar" id="bar" aria-hidden="true">
          <div class="target" id="target"></div>
          <div class="needle" id="needle"></div>
        </div>

        <div class="controls">
          <button id="dropBtn" type="button">Á©ç„ÇÄÔºÅ</button>
          <button id="startBtn" class="secondary" type="button">START / RESTART</button>
        </div>

        <p class="guide">Èáù„ÅåÁ∑ë„Çæ„Éº„É≥„Å´Èáç„Å™„ÇãÁû¨Èñì„Å´„ÄåÁ©ç„ÇÄÔºÅ„Äç„ÅßÈ´òÂæóÁÇπ„ÄÇ45Áßí„ÅßCPU„Çà„ÇäÈ´ò„ÅèÁ©ç„ÇÅ„Å∞ÂãùÂà©„ÄÇ</p>
      </div>
    </section>
  </main>

  <script>
    const ANIMALS = ["üê∂", "üê±", "üê∞", "üêº", "ü¶ä", "üêµ", "üêØ", "üê∏", "üêπ", "ü¶Å", "üê®", "ü¶ù"];

    const timerEl = document.getElementById("timer");
    const scoreEl = document.getElementById("score");
    const youHeightEl = document.getElementById("youHeight");
    const cpuHeightEl = document.getElementById("cpuHeight");
    const statusEl = document.getElementById("status");
    const youTowerEl = document.getElementById("youTower");
    const cpuTowerEl = document.getElementById("cpuTower");
    const needleEl = document.getElementById("needle");
    const targetEl = document.getElementById("target");
    const dropBtn = document.getElementById("dropBtn");
    const startBtn = document.getElementById("startBtn");
    const arenaEl = document.getElementById("arena");

    const GAME_SECONDS = 45;

    let running = false;
    let score = 0;
    let youHeight = 0;
    let cpuHeight = 0;
    let timeLeft = GAME_SECONDS;
    let targetCenter = 50;
    let targetWidth = 24;
    let needle = 0;
    let velocity = 0.85;
    let rafId = null;
    let timerId = null;
    let cpuTickId = null;

    function randomAnimal() {
      return ANIMALS[Math.floor(Math.random() * ANIMALS.length)];
    }

    function setStatus(text, kind = "") {
      statusEl.textContent = text;
      statusEl.className = `status${kind ? ` ${kind}` : ""}`;
    }

    function updateHud() {
      timerEl.textContent = `${timeLeft}s`;
      scoreEl.textContent = String(score);
      youHeightEl.textContent = String(youHeight);
      cpuHeightEl.textContent = String(cpuHeight);
    }

    function addBlock(targetEl, animal, isAi = false) {
      const block = document.createElement("div");
      block.className = `block${isAi ? " ai" : ""}`;
      block.textContent = animal;
      targetEl.prepend(block);
    }

    function moveNeedle() {
      needle += velocity;
      if (needle >= 100) {
        needle = 100;
        velocity *= -1;
      } else if (needle <= 0) {
        needle = 0;
        velocity *= -1;
      }
      needleEl.style.left = `calc(${needle}% - 5px)`;
      if (running) {
        rafId = requestAnimationFrame(moveNeedle);
      }
    }

    function moveTarget() {
      const swing = Math.sin(Date.now() / 620) * 28;
      targetCenter = 50 + swing;
      targetEl.style.left = `${targetCenter - targetWidth / 2}%`;
      targetEl.style.width = `${targetWidth}%`;
    }

    function evaluateDrop() {
      if (!running) {
        return;
      }

      const diff = Math.abs(needle - targetCenter);
      const perfectRange = targetWidth * 0.18;
      const goodRange = targetWidth * 0.54;

      if (diff <= perfectRange) {
        score += 3;
        youHeight += 1;
        addBlock(youTowerEl, randomAnimal());
        setStatus("Perfect! +3", "good");
      } else if (diff <= goodRange) {
        score += 1;
        youHeight += 1;
        addBlock(youTowerEl, randomAnimal());
        setStatus("Good +1", "good");
      } else {
        cpuHeight += 1;
        addBlock(cpuTowerEl, randomAnimal(), true);
        setStatus("Miss... CPU„ÅåÁ©ç„Åø‰∏ä„Åí„Åü", "bad");
      }

      targetWidth = Math.max(10, 24 - Math.floor(youHeight / 3));
      updateHud();
      checkOverflow();
    }

    function checkOverflow() {
      const maxBlocks = 16;
      if (youHeight >= maxBlocks || cpuHeight >= maxBlocks) {
        finishGame();
      }
    }

    function cpuTick() {
      if (!running) {
        return;
      }
      const rush = timeLeft <= 15 ? 0.58 : 0.46;
      if (Math.random() < rush) {
        cpuHeight += 1;
        addBlock(cpuTowerEl, randomAnimal(), true);
        updateHud();
        checkOverflow();
      }
      moveTarget();
    }

    function finishGame() {
      if (!running) {
        return;
      }
      running = false;
      cancelAnimationFrame(rafId);
      clearInterval(timerId);
      clearInterval(cpuTickId);

      let result = "Âºï„ÅçÂàÜ„Åë";
      if (youHeight > cpuHeight) {
        result = "„ÅÇ„Å™„Åü„ÅÆÂãù„Å°";
      } else if (youHeight < cpuHeight) {
        result = "CPU„ÅÆÂãù„Å°";
      }

      setStatus(`ÁµÇ‰∫Ü: ${result} (YOU ${youHeight} - CPU ${cpuHeight})`);
    }

    function resetGame() {
      running = false;
      cancelAnimationFrame(rafId);
      clearInterval(timerId);
      clearInterval(cpuTickId);

      score = 0;
      youHeight = 0;
      cpuHeight = 0;
      timeLeft = GAME_SECONDS;
      targetWidth = 24;
      needle = 0;
      velocity = 0.85;

      youTowerEl.innerHTML = "";
      cpuTowerEl.innerHTML = "";
      needleEl.style.left = "calc(0% - 5px)";
      moveTarget();
      updateHud();
      setStatus("START„ÇíÊäº„Åó„Å¶ÂãùË≤†ÈñãÂßã");
    }

    function startGame() {
      resetGame();
      running = true;
      setStatus("„Éê„Éà„É´‰∏≠... „Çø„Ç§„Éü„É≥„Ç∞„ÇíÂêà„Çè„Åõ„Å¶Á©ç„ÇÇ„ÅÜ");
      moveNeedle();

      timerId = setInterval(() => {
        if (!running) {
          return;
        }
        timeLeft -= 1;
        updateHud();
        if (timeLeft <= 0) {
          finishGame();
        }
      }, 1000);

      cpuTickId = setInterval(cpuTick, 850);
    }

    dropBtn.addEventListener("click", evaluateDrop);
    startBtn.addEventListener("click", startGame);
    arenaEl.addEventListener("click", (event) => {
      if (event.target.closest("button")) {
        return;
      }
      evaluateDrop();
    });

    resetGame();
  </script>
</body>
</html>
